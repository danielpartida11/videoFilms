/**
 * @desc Test server to host and respond to client and e2e testing
 */
'use strict';

var express = require('express'),
    app = express(),
    server = require('http').createServer(app),
    upper = require(process.cwd() + '/index.js')({ server: server }),
    fs = require('fs');

// Get all complete uploaded files in once place:
upper.on('uploaded', function (fileData, cb) {
    fs.unlink('./test/resources/data/result.jpg', function () {;
        fs.writeFileSync('./test/resources/data/result.jpg', fileData.data);
        cb('this is your callback!');
    });
});

app
.set('port', 9000)
.use(upper.client({ express: true, angular: true }))
.use(express.static(__dirname + '/../../test/resources/public'))
.get('/', function (req, res) {
    return res.set('Content-Type', 'text/html') && res.write(fs.readFileSync(__dirname + '/html/index.html')) && res.end();
})
.get('/angular', function (req, res) {
    return res.set('Content-Type', 'text/html') && res.write(fs.readFileSync(__dirname + '/html/angular.html')) && res.end();
})
.get('/amd', function (req, res) {
    return res.set('Content-Type', 'text/html') && res.write(fs.readFileSync(__dirname + '/html/AMD.html')) && res.end();
})
.use(function (req, res) {
    res.redirect('/');
});

server.listen(app.get('port'), function () {
    console.log('Listening on port ' + app.get('port'));
});

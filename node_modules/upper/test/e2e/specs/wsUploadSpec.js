'use strict';

var fs = require('fs');

module.exports = {
    'Upload an image': function (browser) {
        fs.unlink(process.cwd() + '/test/resources/data/result.jpg', function () {

            browser
            .url('http://localhost:9000')
            .waitForElementVisible('body', 1000)
            .pause(2000)
            .assert.hidden('#preview')
            .setValue('input#fileUpload', require('path').resolve(process.cwd() + '/test/resources/data/image.jpg'))
            .pause(2000)
            .assert.visible('#preview')
            .pause(2000, function () {

                var original = fs.readFileSync(process.cwd() + '/test/resources/data/image.jpg'),
                    result = fs.readFileSync(process.cwd() + '/test/resources/data/result.jpg');

                /*jshint -W018 */
                if(!(original <= result)) {
                    throw new Error('Image not uploaded correctly!');
                }

                browser.end();
            });
        });
    }
};

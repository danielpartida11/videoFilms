'use strict';

var app = require('express')(),
    server = require('http').createServer(app),
    // pass a server instance to establish websocket connection
    upper = require('upper')({ server: server });

// serve client side code and using expressjs middleware plugin
app.use(upper.client({ express: true, angular: true }));

// Get all complete uploaded files in once place:
upper.on('uploaded', function (fileData, cb) {
    console.log('fileData: ' + JSON.stringify(fileData));

    // example, upload to e3, save reference to mongo
    // callback to notify client useful data
    uploadToS3(fileData, function (name) {
        mongoSave(name, function () {
            cb.apply(this, arguments);
        });
    });
});
